# ANOVA(분산분석) 검정 완벽 가이드

## 1. ANOVA의 기본 개념

**ANOVA(Analysis of Variance, 분산분석)**는 **3개 이상의 집단** 간 평균 차이를 검정하는 통계적 방법입니다.

### 왜 t-검정을 여러 번 하지 않고 ANOVA를 사용할까?

```
예: A, B, C 세 집단 비교
- t-검정 3번: A-B, A-C, B-C 비교
- 문제점: 1종 오류(α) 누적 증가
  - α = 0.05일 때, 3번 검정 시: 1-(1-0.05)³ ≈ 0.143 (14.3%)
  
- ANOVA: 한 번의 검정으로 전체 집단 차이 판단
  - α = 0.05 유지
```

---

## 2. ANOVA의 종류

### (1) **일원배치 ANOVA (One-way ANOVA)**
- **독립변수 1개** (범주형)
- 예: 세 가지 교육방법(A, B, C)이 시험 성적에 미치는 영향

### (2) **이원배치 ANOVA (Two-way ANOVA)**
- **독립변수 2개** (범주형)
- 주효과(Main Effect) + 상호작용효과(Interaction Effect) 분석
- 예: 교육방법(A, B, C)과 성별(남, 여)이 성적에 미치는 영향

### (3) **반복측정 ANOVA (Repeated Measures ANOVA)**
- 동일 개체를 **여러 시점**에 반복 측정
- 예: 동일인의 약물 투여 전-중-후 혈압 측정

### (4) **MANOVA (Multivariate ANOVA)**
- **종속변수가 2개 이상**인 경우

---

## 3. ANOVA의 기본 가정

### ✅ 반드시 확인해야 할 3가지 가정

| 가정 | 내용 | 확인 방법 |
|-----|------|----------|
| **1. 정규성** | 각 집단의 데이터가 정규분포 | Shapiro-Wilk, Q-Q plot |
| **2. 등분산성** | 각 집단의 분산이 동일 | Levene's test, Bartlett's test |
| **3. 독립성** | 관측값들이 서로 독립적 | 실험 설계로 보장 |

**가정 위배 시 대안:**
- 정규성 위배 → Kruskal-Wallis test (비모수 검정)
- 등분산성 위배 → Welch's ANOVA

---

## 4. ANOVA의 원리: 변동 분해

### 핵심 개념: 총변동 = 집단간 변동 + 집단내 변동

```
SST (총변동) = SSB (집단간 변동) + SSW (집단내 변동)
Total         Between groups      Within groups
```

### 수식으로 이해하기

**1) SST (총 제곱합, Total Sum of Squares)**
```
SST = Σ(xᵢⱼ - x̄..)²
```
- x̄.. : 전체 평균
- 전체 데이터의 변동

**2) SSB (집단간 제곱합, Between-group Sum of Squares)**
```
SSB = Σnⱼ(x̄ⱼ - x̄..)²
```
- x̄ⱼ : j번째 집단 평균
- nⱼ : j번째 집단 크기
- 집단 평균들이 전체 평균에서 얼마나 떨어져 있는가?

**3) SSW (집단내 제곱합, Within-group Sum of Squares)**
```
SSW = ΣΣ(xᵢⱼ - x̄ⱼ)²
```
- 각 집단 내에서의 변동 (오차)

---

## 5. F-통계량과 검정 절차

### F-통계량 계산

```
F = MSB / MSW

여기서,
MSB = SSB / (k-1)     : 집단간 평균제곱 (k: 집단 수)
MSW = SSW / (N-k)     : 집단내 평균제곱 (N: 총 표본 크기)
```

### ANOVA 표 (ANOVA Table)

| 요인 | 제곱합(SS) | 자유도(df) | 평균제곱(MS) | F-통계량 | p-value |
|-----|-----------|-----------|-------------|---------|---------|
| 집단간 | SSB | k-1 | SSB/(k-1) | MSB/MSW | p |
| 집단내 | SSW | N-k | SSW/(N-k) | - | - |
| 총계 | SST | N-1 | - | - | - |

### 검정 절차

```
1. 가설 설정
   H₀: μ₁ = μ₂ = μ₃ = ... = μₖ (모든 집단 평균이 같다)
   H₁: 적어도 한 집단의 평균이 다르다

2. 유의수준 설정 (보통 α = 0.05)

3. F-통계량 계산

4. 의사결정
   - p-value < α → H₀ 기각 (집단 간 차이 있음)
   - p-value ≥ α → H₀ 채택 (집단 간 차이 없음)
```

---

## 6. 사후검정 (Post-hoc Test)

ANOVA에서 H₀를 기각하면 → **"어느 집단들 간에 차이가 있는지"** 확인 필요

### 주요 사후검정 방법

| 방법 | 특징 | 사용 시기 |
|-----|------|----------|
| **Tukey HSD** | 모든 쌍 비교, 보수적 | 집단 크기 동일 시 |
| **Bonferroni** | 매우 보수적, α 조정 | 비교 횟수 적을 때 |
| **Scheffé** | 가장 보수적 | 복잡한 비교 시 |
| **Duncan** | 덜 보수적 | 탐색적 연구 |
| **Dunnett** | 대조군과의 비교 | 대조군 있을 때 |

---

## 7. 수치 예제: 교육방법과 시험성적

### 예제 상황
3가지 교육방법(A, B, C)이 시험 성적에 미치는 영향을 조사

### 원시 데이터 (Raw Data)

| 학생 | 교육방법 A | 교육방법 B | 교육방법 C |
|------|-----------|-----------|-----------|
| 1 | 65 | 75 | 70 |
| 2 | 70 | 80 | 68 |
| 3 | 68 | 78 | 72 |
| 4 | 72 | 82 | 69 |
| 5 | 67 | 77 | 71 |

### 기술통계량

| 통계량 | 교육방법 A | 교육방법 B | 교육방법 C |
|--------|-----------|-----------|-----------|
| **표본 크기 (n)** | 5 | 5 | 5 |
| **합계 (Σx)** | 342 | 392 | 350 |
| **평균 (x̄)** | 68.4 | 78.4 | 70.0 |
| **분산 (s²)** | 6.8 | 6.8 | 2.5 |
| **표준편차 (s)** | 2.61 | 2.61 | 1.58 |

**전체 평균 (x̄..) = 1084 / 15 = 72.27**

---

## 8. ANOVA 계산 과정

### Step 1: 총 제곱합 (SST) 계산

```
SST = Σ(각 관측값 - 전체평균)²
```

| 교육방법 | 관측값 | 전체평균 | 편차 | 편차² |
|---------|-------|---------|------|-------|
| A | 65 | 72.27 | -7.27 | 52.85 |
| A | 70 | 72.27 | -2.27 | 5.15 |
| A | 68 | 72.27 | -4.27 | 18.23 |
| A | 72 | 72.27 | -0.27 | 0.07 |
| A | 67 | 72.27 | -5.27 | 27.77 |
| B | 75 | 72.27 | 2.73 | 7.45 |
| B | 80 | 72.27 | 7.73 | 59.75 |
| B | 78 | 72.27 | 5.73 | 32.83 |
| B | 82 | 72.27 | 9.73 | 94.67 |
| B | 77 | 72.27 | 4.73 | 22.37 |
| C | 70 | 72.27 | -2.27 | 5.15 |
| C | 68 | 72.27 | -4.27 | 18.23 |
| C | 72 | 72.27 | -0.27 | 0.07 |
| C | 69 | 72.27 | -3.27 | 10.69 |
| C | 71 | 72.27 | -1.27 | 1.61 |

**SST = 356.89**

---

### Step 2: 집단간 제곱합 (SSB) 계산

```
SSB = Σn(각 집단평균 - 전체평균)²
```

| 교육방법 | 표본크기(n) | 집단평균 | 전체평균 | 편차 | 편차² | n×편차² |
|---------|------------|---------|---------|------|-------|---------|
| A | 5 | 68.4 | 72.27 | -3.87 | 14.98 | **74.90** |
| B | 5 | 78.4 | 72.27 | 6.13 | 37.58 | **187.90** |
| C | 5 | 70.0 | 72.27 | -2.27 | 5.15 | **25.75** |

**SSB = 74.90 + 187.90 + 25.75 = 288.55**

---

### Step 3: 집단내 제곱합 (SSW) 계산

```
SSW = SST - SSB = 356.89 - 288.55 = 68.34
```

또는 직접 계산:

**교육방법 A:**
| 관측값 | 집단평균 | 편차 | 편차² |
|-------|---------|------|-------|
| 65 | 68.4 | -3.4 | 11.56 |
| 70 | 68.4 | 1.6 | 2.56 |
| 68 | 68.4 | -0.4 | 0.16 |
| 72 | 68.4 | 3.6 | 12.96 |
| 67 | 68.4 | -1.4 | 1.96 |
| **합계** | | | **29.20** |

**교육방법 B:** 29.20 (동일 계산)

**교육방법 C:** 10.00

**SSW = 29.20 + 29.20 + 10.00 = 68.40**

---

## 9. ANOVA Table (분산분석표)

| 요인 | 제곱합(SS) | 자유도(df) | 평균제곱(MS) | F-통계량 | F-임계값(α=0.05) | p-value |
|------|-----------|-----------|-------------|---------|------------------|---------|
| **집단간** | 288.55 | 2 | 144.28 | **25.34** | 3.89 | **< 0.001** |
| **집단내** | 68.40 | 12 | 5.70 | - | - | - |
| **총계** | 356.95 | 14 | - | - | - | - |

### 계산 과정:

```
📊 자유도 (df)
- df_between = k - 1 = 3 - 1 = 2
- df_within = N - k = 15 - 3 = 12
- df_total = N - 1 = 15 - 1 = 14

📊 평균제곱 (MS)
- MSB = SSB / df_between = 288.55 / 2 = 144.28
- MSW = SSW / df_within = 68.40 / 12 = 5.70

📊 F-통계량
- F = MSB / MSW = 144.28 / 5.70 = 25.34

📊 의사결정
- F-계산값(25.34) > F-임계값(3.89)
- p-value < 0.001 < α(0.05)
→ 귀무가설 기각! (집단 간 유의한 차이 있음)
```

---

## 10. 가설 검정 결과

```
H₀: μA = μB = μC (세 교육방법의 평균 성적이 같다)
H₁: 적어도 한 교육방법의 평균 성적이 다르다

유의수준: α = 0.05
```

### 결과:
- **F-통계량 = 25.34**
- **p-value < 0.001**
- **결론: 귀무가설 기각**

✅ **세 교육방법 간 시험 성적에 통계적으로 유의한 차이가 있습니다.**

---

## 11. 사후검정 결과 (Tukey HSD)

### Tukey HSD 검정 결과

| 비교 | 평균차이 | 표준오차 | q-통계량 | p-value | 유의성 |
|------|---------|---------|---------|---------|--------|
| **B vs A** | 10.00 | 1.51 | 6.63 | **0.0012** | ✅ 유의 |
| **C vs A** | 1.60 | 1.51 | 1.06 | 0.5634 | ✗ 비유의 |
| **C vs B** | -8.40 | 1.51 | -5.57 | **0.0034** | ✅ 유의 |

### Tukey HSD 계산:
```
HSD = q × √(MSW/n)
HSD = 3.77 × √(5.70/5) = 3.77 × 1.07 = 4.03

여기서 q(0.05, 3, 12) ≈ 3.77
```

### 평균 차이 비교:

| 비교 | 평균차이 | HSD | 결론 |
|------|---------|-----|------|
| |x̄B - x̄A| | 10.00 | 4.03 | **10.00 > 4.03** → 유의 ✅ |
| |x̄C - x̄A| | 1.60 | 4.03 | **1.60 < 4.03** → 비유의 ✗ |
| |x̄C - x̄B| | 8.40 | 4.03 | **8.40 > 4.03** → 유의 ✅ |

---

## 12. 시각적 표현

```
평균 성적 비교 (95% 신뢰구간)

교육방법 A:  68.4  [━━━━━━━◉━━━━━━━]
교육방법 B:  78.4              [━━━━━━━◉━━━━━━━]  ⭐ 최고
교육방법 C:  70.0    [━━━━━━━◉━━━━━━━]

         |----|----|----|----|----|----|
        65   68   71   74   77   80   83

📊 결론:
✅ 교육방법 B가 A, C보다 유의하게 높은 성적
✗ 교육방법 A와 C 간에는 유의한 차이 없음
```

---

## 13. Python 실습 예제

```python
import numpy as np
from scipy import stats
import pandas as pd

# 데이터 입력
A = np.array([65, 70, 68, 72, 67])
B = np.array([75, 80, 78, 82, 77])
C = np.array([70, 68, 72, 69, 71])

# 기술통계
print("=== 기술통계량 ===")
print(f"교육방법 A: 평균={A.mean():.2f}, 표준편차={A.std(ddof=1):.2f}")
print(f"교육방법 B: 평균={B.mean():.2f}, 표준편차={B.std(ddof=1):.2f}")
print(f"교육방법 C: 평균={C.mean():.2f}, 표준편차={C.std(ddof=1):.2f}")
print(f"전체 평균: {np.concatenate([A,B,C]).mean():.2f}\n")

# ANOVA 수행
f_stat, p_value = stats.f_oneway(A, B, C)

print("=== ANOVA 결과 ===")
print(f"F-통계량: {f_stat:.2f}")
print(f"p-value: {p_value:.6f}\n")

if p_value < 0.05:
    print("✅ 결론: 집단 간 유의한 차이가 있습니다 (p < 0.05)")
else:
    print("✗ 결론: 집단 간 유의한 차이가 없습니다 (p ≥ 0.05)")

# 사후검정 (Tukey HSD)
from statsmodels.stats.multicomp import pairwise_tukeyhsd

data = np.concatenate([A, B, C])
groups = ['A']*5 + ['B']*5 + ['C']*5

print("\n=== Tukey HSD 사후검정 ===")
tukey = pairwise_tukeyhsd(data, groups, alpha=0.05)
print(tukey)
```

---

## 14. 이원배치 ANOVA 예제

```python
# 이원배치 ANOVA: 교육방법 + 성별
from statsmodels.formula.api import ols
from statsmodels.stats.anova import anova_lm

# 데이터 생성
np.random.seed(42)
data = {
    '성적': np.concatenate([
        np.random.normal(75, 8, 20),  # A-남
        np.random.normal(77, 8, 20),  # A-여
        np.random.normal(82, 8, 20),  # B-남
        np.random.normal(80, 8, 20),  # B-여
        np.random.normal(78, 8, 20),  # C-남
        np.random.normal(76, 8, 20),  # C-여
    ]),
    '교육방법': ['A']*40 + ['B']*40 + ['C']*40,
    '성별': (['남']*20 + ['여']*20) * 3
}
df = pd.DataFrame(data)

# 모델 적합
model = ols('성적 ~ C(교육방법) + C(성별) + C(교육방법):C(성별)', data=df).fit()
anova_table = anova_lm(model, typ=2)

print("=== 이원배치 ANOVA ===")
print(anova_table)
```

### 해석:
- **주효과 (Main Effects)**
  - 교육방법: 교육방법이 성적에 미치는 영향
  - 성별: 성별이 성적에 미치는 영향

- **상호작용효과 (Interaction Effect)**
  - 교육방법:성별: 교육방법의 효과가 성별에 따라 다른가?

---

## 15. 결과 해석 가이드

### ANOVA 결과 해석

```
F-statistic = 5.43, p-value = 0.006

해석:
✓ p-value(0.006) < α(0.05)
→ 귀무가설 기각
→ 적어도 한 집단의 평균이 다릅니다

⚠️ 주의: ANOVA는 "어느 집단이 다른지"는 알려주지 않음
→ 사후검정 필요!
```

### Tukey HSD 결과 해석

```
  group1 group2  meandiff   p-adj   reject
0      A      B    -5.234  0.0123     True
1      A      C    -2.891  0.3456    False
2      B      C     2.343  0.4567    False

해석:
✓ A-B 그룹 간 유의한 차이 (p=0.0123 < 0.05)
✗ A-C, B-C 그룹 간 유의한 차이 없음
```

---

## 16. 실전 팁 & 체크리스트

### ✅ ANOVA 수행 전 체크리스트

1. [ ] 종속변수가 **연속형**(등간/비율척도)인가?
2. [ ] 독립변수가 **범주형**인가?
3. [ ] 집단이 **3개 이상**인가?
4. [ ] **정규성** 가정을 만족하는가?
5. [ ] **등분산성** 가정을 만족하는가?
6. [ ] **독립성** 가정을 만족하는가?

### 🔧 문제 해결

| 문제 | 해결방법 |
|-----|---------|
| 정규성 위배 | Kruskal-Wallis test (비모수) |
| 등분산성 위배 | Welch's ANOVA |
| 표본 크기 작음 | 비모수 검정 고려 |
| 이상치 존재 | 로버스트 ANOVA |

---

## 17. 빅데이터분석기사 시험 대비 핵심

### 반드시 암기할 공식

```
1. F = MSB / MSW
2. MSB = SSB / (k-1)
3. MSW = SSW / (N-k)
4. SST = SSB + SSW
5. 자유도: df_B = k-1, df_W = N-k
```

### 시험 문제 유형

1. **ANOVA 표 완성** (제곱합, 자유도, 평균제곱, F값 계산)
2. **가설 검정** (가설 설정, 의사결정)
3. **사후검정** 선택 및 해석
4. **Python 코드** 작성 (scipy.stats.f_oneway)

---

## 18. 최종 보고서 형식

### 연구 질문
3가지 교육방법(A, B, C)이 학생들의 시험 성적에 차이를 만드는가?

### 방법
- 표본: 각 그룹 5명, 총 15명
- 분석 방법: 일원배치 ANOVA (One-way ANOVA)
- 유의수준: α = 0.05

### 결과
일원배치 ANOVA 결과, 세 교육방법 간 시험 성적에 통계적으로 유의한 차이가 발견되었다 (F(2, 12) = 25.34, p < 0.001).

Tukey HSD 사후검정 결과, 교육방법 B(M = 78.4, SD = 2.61)가 교육방법 A(M = 68.4, SD = 2.61, p = 0.0012) 및 교육방법 C(M = 70.0, SD = 1.58, p = 0.0034)보다 유의하게 높은 성적을 보였다. 교육방법 A와 C 간에는 유의한 차이가 없었다 (p = 0.5634).

### 결론
**교육방법 B가 가장 효과적**인 것으로 나타났다.

---

## 참고자료

- 빅데이터분석기사 실기 가이드
- Python scipy.stats 공식 문서
- statsmodels ANOVA 문서

---

**작성일**: 2026-01-19
**버전**: 1.0
