# 교차분석, 카이제곱 검정, 잔차분석 완벽 가이드

## 📌 개요

| 분석 방법 | 목적 | 분석 유형 |
|---|---|---|
| **교차분석** | 범주형 변수 간 빈도 분포 파악 | 기술통계 |
| **카이제곱 검정** | 변수 간 관계의 통계적 유의성 검증 | 추론통계 |
| **잔차분석** | 유의한 결과에서 어떤 셀이 기여했는지 파악 | 사후분석 |

---

## 🔍 분석 흐름도

```
┌─────────────────┐
│   교차분석      │  → 교차표 작성, 빈도/비율 확인
└────────┬────────┘
         ▼
┌─────────────────┐
│ 카이제곱 검정   │  → χ² 계산, 유의성 판단
└────────┬────────┘
         ▼
    ┌────┴────┐
    │ 유의한가? │
    └────┬────┘
    Yes  │  No
    ▼    └──→ 분석 종료 (변수 간 관계 없음)
┌─────────────────┐
│   잔차분석      │  → 어떤 셀이 유의한 차이를 보이는지 파악
└─────────────────┘
```

---

## 📊 예제 데이터

### 연구 문제
> "연령대(청년/중년/장년)에 따라 선호하는 운동 종류(헬스/수영/요가)가 다른가?"

### 관찰빈도 (Observed Frequency)

| | 헬스 | 수영 | 요가 | **행 합계** |
|---|:---:|:---:|:---:|:---:|
| **청년 (20-30대)** | 50 | 20 | 10 | 80 |
| **중년 (40-50대)** | 30 | 35 | 25 | 90 |
| **장년 (60대 이상)** | 10 | 25 | 45 | 80 |
| **열 합계** | 90 | 80 | 80 | **250** |

---

## 1️⃣ 교차분석 (Cross-tabulation Analysis)

### 1.1 정의
두 개 이상의 **범주형 변수** 간의 관계를 **빈도표**로 정리하여 분포 패턴을 파악하는 기술통계 방법

### 1.2 행 비율 분석 (Row Percentage)

각 연령대 내에서 운동 종류별 선호 비율:

| | 헬스 | 수영 | 요가 | 합계 |
|---|:---:|:---:|:---:|:---:|
| **청년** | 50/80 = **62.5%** | 20/80 = 25.0% | 10/80 = 12.5% | 100% |
| **중년** | 30/90 = 33.3% | 35/90 = **38.9%** | 25/90 = 27.8% | 100% |
| **장년** | 10/80 = 12.5% | 25/80 = 31.3% | 45/80 = **56.3%** | 100% |

### 1.3 교차분석 해석

- **청년층**: 헬스(62.5%)를 압도적으로 선호
- **중년층**: 수영(38.9%)을 가장 선호하나 비교적 고른 분포
- **장년층**: 요가(56.3%)를 가장 선호

**교차분석의 한계**: 이 차이가 우연에 의한 것인지, 통계적으로 유의미한지 판단 불가
→ **카이제곱 검정** 필요

---

## 2️⃣ 카이제곱 검정 (Chi-square Test)

### 2.1 정의
관찰빈도와 기대빈도 간의 차이가 **통계적으로 유의한지** 검증하는 추론통계 방법

### 2.2 가설 설정

- **귀무가설 (H₀)**: 연령대와 운동 선호는 **독립**이다 (관련이 없다)
- **대립가설 (H₁)**: 연령대와 운동 선호는 **독립이 아니다** (관련이 있다)

### 2.3 기대빈도 (Expected Frequency) 계산

**기대빈도 공식:**
$$E_{ij} = \frac{(\text{행 합계}_i) \times (\text{열 합계}_j)}{\text{총합}}$$

**계산 과정:**

| | 헬스 | 수영 | 요가 |
|---|:---:|:---:|:---:|
| **청년** | (80×90)/250 = **28.8** | (80×80)/250 = **25.6** | (80×80)/250 = **25.6** |
| **중년** | (90×90)/250 = **32.4** | (90×80)/250 = **28.8** | (90×80)/250 = **28.8** |
| **장년** | (80×90)/250 = **28.8** | (80×80)/250 = **25.6** | (80×80)/250 = **25.6** |

### 2.4 카이제곱 통계량 계산

**카이제곱 공식:**
$$\chi^2 = \sum_{i=1}^{r} \sum_{j=1}^{c} \frac{(O_{ij} - E_{ij})^2}{E_{ij}}$$

**셀별 계산:**

| 셀 | 관찰빈도 (O) | 기대빈도 (E) | O - E | (O - E)² | (O - E)²/E |
|---|:---:|:---:|:---:|:---:|:---:|
| 청년-헬스 | 50 | 28.8 | +21.2 | 449.44 | **15.606** |
| 청년-수영 | 20 | 25.6 | -5.6 | 31.36 | 1.225 |
| 청년-요가 | 10 | 25.6 | -15.6 | 243.36 | **9.506** |
| 중년-헬스 | 30 | 32.4 | -2.4 | 5.76 | 0.178 |
| 중년-수영 | 35 | 28.8 | +6.2 | 38.44 | 1.335 |
| 중년-요가 | 25 | 28.8 | -3.8 | 14.44 | 0.501 |
| 장년-헬스 | 10 | 28.8 | -18.8 | 353.44 | **12.272** |
| 장년-수영 | 25 | 25.6 | -0.6 | 0.36 | 0.014 |
| 장년-요가 | 45 | 25.6 | +19.4 | 376.36 | **14.702** |
| **합계** | | | | | **χ² = 55.339** |

### 2.5 자유도 및 임계값

**자유도 공식:**
$$df = (r - 1) \times (c - 1) = (3 - 1) \times (3 - 1) = 4$$

**카이제곱 분포 임계값표 (주요 값):**

| 자유도 | α = 0.05 | α = 0.01 | α = 0.001 |
|:---:|:---:|:---:|:---:|
| 1 | 3.841 | 6.635 | 10.828 |
| 2 | 5.991 | 9.210 | 13.816 |
| 3 | 7.815 | 11.345 | 16.266 |
| **4** | **9.488** | **13.277** | **18.467** |
| 5 | 11.070 | 15.086 | 20.515 |

### 2.6 유의성 판단

| 비교 항목 | 값 |
|---|:---:|
| 계산된 χ² | **55.339** |
| 임계값 (df=4, α=0.05) | 9.488 |
| 임계값 (df=4, α=0.01) | 13.277 |
| 임계값 (df=4, α=0.001) | 18.467 |

**판정:** χ² = 55.339 > 18.467 (α=0.001)

### 2.7 카이제곱 검정 결론

✅ **귀무가설 기각** (p < 0.001)

→ 연령대와 운동 선호 간에 **통계적으로 매우 유의한 관계가 있다**

**하지만 의문점**: 어떤 연령대의 어떤 운동 선호가 이 유의한 결과에 기여했는가?
→ **잔차분석** 필요

---

## 3️⃣ 잔차분석 (Residual Analysis)

### 3.1 정의
카이제곱 검정이 유의할 때, **어떤 셀(조합)이 유의한 차이에 기여**했는지 파악하는 사후분석 방법

### 3.2 잔차의 종류

| 잔차 유형 | 공식 | 용도 |
|---|---|---|
| **잔차 (Residual)** | $R = O - E$ | 기본적인 차이 |
| **표준화 잔차 (Standardized Residual)** | $SR = \frac{O - E}{\sqrt{E}}$ | 크기 비교 가능 |
| **조정 표준화 잔차 (Adjusted Standardized Residual)** | $ASR = \frac{O - E}{\sqrt{E(1-p_i)(1-p_j)}}$ | **셀별 유의성 판단** |

### 3.3 조정 표준화 잔차 공식

$$ASR_{ij} = \frac{O_{ij} - E_{ij}}{\sqrt{E_{ij} \times (1 - \frac{R_i}{N}) \times (1 - \frac{C_j}{N})}}$$

- $O_{ij}$: 관찰빈도
- $E_{ij}$: 기대빈도
- $R_i$: 행 합계
- $C_j$: 열 합계
- $N$: 총합

### 3.4 조정 표준화 잔차 계산

**각 셀별 계산:**

#### 청년-헬스
$$ASR = \frac{50 - 28.8}{\sqrt{28.8 \times (1 - \frac{80}{250}) \times (1 - \frac{90}{250})}} = \frac{21.2}{\sqrt{28.8 \times 0.68 \times 0.64}} = \frac{21.2}{\sqrt{12.533}} = \frac{21.2}{3.540} = \textbf{+5.99}$$

#### 청년-수영
$$ASR = \frac{20 - 25.6}{\sqrt{25.6 \times (1 - \frac{80}{250}) \times (1 - \frac{80}{250})}} = \frac{-5.6}{\sqrt{25.6 \times 0.68 \times 0.68}} = \frac{-5.6}{\sqrt{11.837}} = \frac{-5.6}{3.440} = \textbf{-1.63}$$

#### 청년-요가
$$ASR = \frac{10 - 25.6}{\sqrt{25.6 \times 0.68 \times 0.68}} = \frac{-15.6}{3.440} = \textbf{-4.53}$$

#### 중년-헬스
$$ASR = \frac{30 - 32.4}{\sqrt{32.4 \times (1 - \frac{90}{250}) \times (1 - \frac{90}{250})}} = \frac{-2.4}{\sqrt{32.4 \times 0.64 \times 0.64}} = \frac{-2.4}{\sqrt{13.271}} = \frac{-2.4}{3.643} = \textbf{-0.66}$$

#### 중년-수영
$$ASR = \frac{35 - 28.8}{\sqrt{28.8 \times (1 - \frac{90}{250}) \times (1 - \frac{80}{250})}} = \frac{6.2}{\sqrt{28.8 \times 0.64 \times 0.68}} = \frac{6.2}{\sqrt{12.533}} = \frac{6.2}{3.540} = \textbf{+1.75}$$

#### 중년-요가
$$ASR = \frac{25 - 28.8}{\sqrt{28.8 \times 0.64 \times 0.68}} = \frac{-3.8}{3.540} = \textbf{-1.07}$$

#### 장년-헬스
$$ASR = \frac{10 - 28.8}{\sqrt{28.8 \times 0.68 \times 0.64}} = \frac{-18.8}{3.540} = \textbf{-5.31}$$

#### 장년-수영
$$ASR = \frac{25 - 25.6}{\sqrt{25.6 \times 0.68 \times 0.68}} = \frac{-0.6}{3.440} = \textbf{-0.17}$$

#### 장년-요가
$$ASR = \frac{45 - 25.6}{\sqrt{25.6 \times 0.68 \times 0.68}} = \frac{19.4}{3.440} = \textbf{+5.64}$$

### 3.5 잔차분석 결과표

| | 헬스 | 수영 | 요가 |
|---|:---:|:---:|:---:|
| **청년** | **+5.99*** | -1.63 | **-4.53*** |
| **중년** | -0.66 | +1.75 | -1.07 |
| **장년** | **-5.31*** | -0.17 | **+5.64*** |

### 3.6 유의성 판단 기준

조정 표준화 잔차는 **표준정규분포**를 따르므로:

| |ASR| | 유의수준 | 해석 |
|:---:|:---:|---|
| ≥ 1.96 | α = 0.05 (*) | 유의한 차이 |
| ≥ 2.58 | α = 0.01 (**) | 매우 유의한 차이 |
| ≥ 3.29 | α = 0.001 (***) | 극히 유의한 차이 |

### 3.7 잔차분석 해석

**유의하게 높은 셀 (양의 잔차):**
| 셀 | ASR | 해석 |
|---|:---:|---|
| 청년-헬스 | +5.99*** | 청년층은 기대보다 **헬스를 훨씬 많이** 선호 |
| 장년-요가 | +5.64*** | 장년층은 기대보다 **요가를 훨씬 많이** 선호 |

**유의하게 낮은 셀 (음의 잔차):**
| 셀 | ASR | 해석 |
|---|:---:|---|
| 장년-헬스 | -5.31*** | 장년층은 기대보다 **헬스를 훨씬 적게** 선호 |
| 청년-요가 | -4.53*** | 청년층은 기대보다 **요가를 훨씬 적게** 선호 |

**유의하지 않은 셀:**
- 중년층의 모든 운동: |ASR| < 1.96 → 기대빈도와 비슷한 분포

---

## 4️⃣ 최종 종합 결론

### 4.1 분석 결과 요약

| 분석 단계 | 결과 |
|---|---|
| **교차분석** | 연령대별 운동 선호 패턴 확인 |
| **카이제곱 검정** | χ²(4) = 55.339, p < 0.001 → 유의한 관계 존재 |
| **잔차분석** | 청년-헬스, 장년-요가 조합이 유의한 차이에 주로 기여 |

### 4.2 실질적 해석

```
┌────────────────────────────────────────────────────┐
│                    연령대별 운동 선호               │
├────────────────────────────────────────────────────┤
│  청년층 → 헬스 선호 ↑↑↑  /  요가 기피 ↓↓↓          │
│  중년층 → 특별한 선호 패턴 없음 (고른 분포)         │
│  장년층 → 요가 선호 ↑↑↑  /  헬스 기피 ↓↓↓          │
└────────────────────────────────────────────────────┘
```

---

## 5️⃣ 분석 시 주의사항

### 5.1 카이제곱 검정의 가정

| 가정 | 내용 | 위반 시 대안 |
|---|---|---|
| **기대빈도 ≥ 5** | 모든 셀의 기대빈도가 5 이상 | Fisher의 정확검정 |
| **독립 표본** | 관측치가 서로 독립적 | McNemar 검정 (대응표본) |
| **범주형 변수** | 연속형 변수는 사용 불가 | 범주화 후 분석 |

### 5.2 기대빈도 5 미만 셀 처리

- 전체 셀의 **20% 이상**이 기대빈도 5 미만이면 검정 결과 신뢰 어려움
- **해결방법**: 인접 범주 합치기, Fisher 정확검정 사용

### 5.3 효과크기 (Effect Size)

카이제곱 검정이 유의해도 **실제 효과가 작을 수 있음** → 효과크기 확인 필요

| 지표 | 공식 | 해석 기준 (Cohen) |
|---|---|---|
| **Phi (φ)** | $\sqrt{\chi^2/N}$ (2×2 표) | 0.1: 작음, 0.3: 중간, 0.5: 큼 |
| **Cramér's V** | $\sqrt{\chi^2/(N \times (k-1))}$ | 0.1: 작음, 0.3: 중간, 0.5: 큼 |

**본 예제의 Cramér's V:**
$$V = \sqrt{\frac{55.339}{250 \times (3-1)}} = \sqrt{\frac{55.339}{500}} = \sqrt{0.1107} = 0.333$$

→ **중간 정도**의 효과크기

---

## 6️⃣ Python 구현 코드

```python
import numpy as np
import pandas as pd
from scipy import stats

# 관찰빈도 데이터
observed = np.array([
    [50, 20, 10],  # 청년
    [30, 35, 25],  # 중년
    [10, 25, 45]   # 장년
])

# 카이제곱 검정
chi2, p_value, dof, expected = stats.chi2_contingency(observed)

print("=" * 50)
print("카이제곱 검정 결과")
print("=" * 50)
print(f"카이제곱 통계량: {chi2:.3f}")
print(f"자유도: {dof}")
print(f"p-value: {p_value:.6f}")
print(f"\n기대빈도:")
print(pd.DataFrame(expected, 
                   index=['청년', '중년', '장년'],
                   columns=['헬스', '수영', '요가']).round(2))

# 조정 표준화 잔차 계산
row_totals = observed.sum(axis=1)
col_totals = observed.sum(axis=0)
n = observed.sum()

adjusted_residuals = np.zeros_like(observed, dtype=float)

for i in range(observed.shape[0]):
    for j in range(observed.shape[1]):
        o = observed[i, j]
        e = expected[i, j]
        row_prop = row_totals[i] / n
        col_prop = col_totals[j] / n
        denominator = np.sqrt(e * (1 - row_prop) * (1 - col_prop))
        adjusted_residuals[i, j] = (o - e) / denominator

print("\n" + "=" * 50)
print("조정 표준화 잔차 (ASR)")
print("=" * 50)
asr_df = pd.DataFrame(adjusted_residuals,
                      index=['청년', '중년', '장년'],
                      columns=['헬스', '수영', '요가'])
print(asr_df.round(2))

# 유의성 표시
print("\n유의한 셀 (|ASR| > 1.96):")
for i, row in enumerate(['청년', '중년', '장년']):
    for j, col in enumerate(['헬스', '수영', '요가']):
        asr = adjusted_residuals[i, j]
        if abs(asr) > 3.29:
            sig = "***"
        elif abs(asr) > 2.58:
            sig = "**"
        elif abs(asr) > 1.96:
            sig = "*"
        else:
            continue
        direction = "높음" if asr > 0 else "낮음"
        print(f"  {row}-{col}: ASR = {asr:+.2f}{sig} ({direction})")

# Cramér's V
k = min(observed.shape) - 1
cramers_v = np.sqrt(chi2 / (n * k))
print(f"\nCramér's V: {cramers_v:.3f}")
```

### 실행 결과
```
==================================================
카이제곱 검정 결과
==================================================
카이제곱 통계량: 55.339
자유도: 4
p-value: 0.000000

기대빈도:
      헬스    수영    요가
청년  28.8  25.6  25.6
중년  32.4  28.8  28.8
장년  28.8  25.6  25.6

==================================================
조정 표준화 잔차 (ASR)
==================================================
      헬스   수영   요가
청년  5.99 -1.63 -4.53
중년 -0.66  1.75 -1.07
장년 -5.31 -0.17  5.64

유의한 셀 (|ASR| > 1.96):
  청년-헬스: ASR = +5.99*** (높음)
  청년-요가: ASR = -4.53*** (낮음)
  장년-헬스: ASR = -5.31*** (낮음)
  장년-요가: ASR = +5.64*** (높음)

Cramér's V: 0.333
```

---

## 📝 빅데이터분석기사 시험 핵심 포인트

### ✅ 자주 출제되는 개념

1. **교차분석 vs 카이제곱 검정 차이**
   - 교차분석: 기술통계 (빈도표 작성)
   - 카이제곱: 추론통계 (유의성 검정)

2. **기대빈도 계산**
   $$E_{ij} = \frac{\text{행 합계} \times \text{열 합계}}{\text{총합}}$$

3. **카이제곱 통계량**
   $$\chi^2 = \sum \frac{(O - E)^2}{E}$$

4. **자유도**
   $$df = (r-1) \times (c-1)$$

5. **기대빈도 5 이상** 조건 확인

6. **조정 표준화 잔차 해석**
   - |ASR| ≥ 1.96 → 유의 (α=0.05)
   - |ASR| ≥ 2.58 → 매우 유의 (α=0.01)

### ✅ 계산 문제 팁

- 기대빈도 계산 시 **소수점 유지** (반올림 주의)
- χ² 계산 시 **모든 셀 합산** 잊지 않기
- 자유도 공식: **(행-1) × (열-1)**
- 임계값 비교: **계산값 > 임계값 → 귀무가설 기각**

---

*작성일: 2025년*
*빅데이터분석기사 실기 대비 학습자료*
